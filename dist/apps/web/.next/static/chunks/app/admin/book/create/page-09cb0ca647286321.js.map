{"version":3,"file":"static/chunks/app/admin/book/create/page-09cb0ca647286321.js","mappings":"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","sources":["webpack://_N_E/?b769","webpack://_N_E/./app/admin/book/create/useTemplate.ts","webpack://_N_E/../../libs/global/validation/book/create.book.dto.ts","webpack://_N_E/./app/admin/book/create/useCreateForm.ts","webpack://_N_E/./app/admin/book/create/page.tsx","webpack://_N_E/./utils/route.ts","webpack://_N_E/<anon>"],"sourcesContent":["import(/* webpackMode: \"eager\" */ \"D:\\\\projects\\\\booknex-2\\\\apps\\\\web\\\\app\\\\admin\\\\book\\\\create\\\\page.tsx\")","import api from '@/services/api'\nimport { errorToast } from '@/utils/toast'\nimport { useMutation, useQuery } from '@tanstack/react-query'\nimport { CreateBookSchemaType } from 'global/validation/book/create.book.dto'\nimport { useLayoutEffect } from 'react'\nimport type { UseFormReset } from 'react-hook-form'\n\nexport const useTemplate = ({\n\ttemplateSlug,\n\treset\n}: {\n\ttemplateSlug: string\n\treset: UseFormReset<CreateBookSchemaType>\n}) => {\n\tconst { data: template } = useQuery({\n\t\tqueryKey: ['book-template'],\n\t\tqueryFn: () => api.parser.bySlug(templateSlug),\n\t\tenabled: Boolean(templateSlug),\n\t\tselect: data => data.data\n\t})\n\tconst { mutateAsync: deleteTemplate } = useMutation({\n\t\tmutationKey: ['delete-template'],\n\t\tmutationFn: (templateSlug: string) => api.parser.remove(templateSlug),\n\t\tonError: () => errorToast('Error while removing template')\n\t})\n\tuseLayoutEffect(() => {\n\t\tif (!template) return\n\t\treset({\n\t\t\ttitle: template.title,\n\t\t\tdescription: template.description,\n\t\t\tauthor: template.author,\n\t\t\trating: template.rating,\n\t\t\tgenres: template.genres\n\t\t})\n\t}, [reset, template])\n\n\treturn { deleteTemplate }\n}\n","import { z } from 'zod'\nimport { EBookPayloadSchema } from './ebook.payload.dto'\n\nexport const shortGenreSchema = z.object({\n\tslug: z.string(),\n\tname: z.string(),\n\ticon: z.string()\n})\nexport const CreateBookSchema = z.object({\n\ttitle: z.string(),\n\tauthor: z.string(),\n\tdescription: z.string().max(1000).min(10),\n\tebook: z.array(EBookPayloadSchema).min(1),\n\trating: z.number().min(1).positive(),\n\tpicture: z.string(),\n\n\tgenres: z.array(shortGenreSchema).min(1)\n})\n\nexport type CreateBookSchemaType = z.infer<typeof CreateBookSchema>\n","import { useTemplate } from '@/app/admin/book/create/useTemplate'\nimport api from '@/services/api'\nimport { secureRoutes } from '@/utils/route'\nimport { successToast } from '@/utils/toast'\nimport { validateStringParameter } from '@/utils/validate-parameter'\nimport { zodResolver } from '@hookform/resolvers/zod'\nimport { useMutation } from '@tanstack/react-query'\nimport type { CreateBookDto } from 'global/api-client'\nimport {\n\tCreateBookSchema,\n\tCreateBookSchemaType\n} from 'global/validation/book/create.book.dto'\n\nimport { useRouter, useSearchParams } from 'next/navigation'\nimport { useForm } from 'react-hook-form'\n//TODO: пофиксить полностью создание книги чтобы работало без багов\nexport const useCreateForm = () => {\n\tconst parameters = useSearchParams()\n\tconst templateSlug = validateStringParameter(parameters.get('template'))\n\tconst router = useRouter()\n\tconst {\n\t\tcontrol,\n\t\treset,\n\t\twatch,\n\t\thandleSubmit,\n\t\tsetValue,\n\t\tgetValues,\n\t\tformState: { errors }\n\t} = useForm<CreateBookSchemaType>({\n\t\tresolver: zodResolver(CreateBookSchema),\n\t\tmode: 'onBlur'\n\t})\n\n\tconst { deleteTemplate } = useTemplate({ templateSlug, reset })\n\n\tconst { mutateAsync: create, isLoading: createLoading } = useMutation({\n\t\tmutationKey: ['create-book'],\n\t\tmutationFn: (payload: CreateBookDto) => api.book.create(payload),\n\t\tonSuccess: async data => {\n\t\t\tconsole.log('data  in success', data)\n\t\t\tif (templateSlug) {\n\t\t\t\tawait deleteTemplate(templateSlug)\n\t\t\t}\n\t\t\tsuccessToast('Book created')\n\t\t\trouter.push(secureRoutes.bookCatalogRoute)\n\t\t}\n\t})\n\n\tconst handleCreate = handleSubmit(async (data: CreateBookSchemaType) => {\n\t\tawait create(data)\n\t})\n\tconsole.log(watch('genres'))\n\treturn {\n\t\twatch,\n\t\tcontrol,\n\t\terrors,\n\t\tsetValue,\n\t\treset,\n\t\tgetValues,\n\t\thandleCreate,\n\t\tcreateLoading\n\t}\n}\n","'use client'\n\nimport EbookEditor from '@/app/admin/book/_components/ebook-editor/editor'\nimport SelectGenres from '@/app/admin/book/_components/select-genres'\nimport { SelectPicture } from '@/app/admin/book/_components/select-picture'\nimport { useCreateForm } from '@/app/admin/book/create/useCreateForm'\nimport { Button, Field, FormTextArea } from '@/components/ui'\nimport { PenNib, Star } from 'icons'\nimport type { FC } from 'react'\n\nconst Page: FC = () => {\n\tconst { control, ...form } = useCreateForm()\n\n\treturn (\n\t\t<div>\n\t\t\t<h1 className='mb-4 text-center text-3xl font-medium'>Create book</h1>\n\t\t\t<div className='mb-4 justify-between gap-5  md:flex'>\n\t\t\t\t<div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h1 className='mt-2  text-xl'>Cover</h1>\n\n\t\t\t\t\t\t<SelectPicture name='picture' control={control} />\n\n\t\t\t\t\t\t<h1 className='mb-2 mt-2  text-xl'>Genres</h1>\n\n\t\t\t\t\t\t<SelectGenres name='genres' control={control} />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div className='w-11/12'>\n\t\t\t\t\t<div className='mt-2  gap-3 md:flex'>\n\t\t\t\t\t\t<div className=' md:w-1/2'>\n\t\t\t\t\t\t\t<h1 className='my-2'>Title</h1>\n\t\t\t\t\t\t\t<Field\n\t\t\t\t\t\t\t\ttype='text'\n\t\t\t\t\t\t\t\tcontrol={control}\n\t\t\t\t\t\t\t\tname='title'\n\t\t\t\t\t\t\t\tplaceholder='Title'\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=' md:w-1/3'>\n\t\t\t\t\t\t\t<h1 className='my-2'>Author</h1>\n\t\t\t\t\t\t\t<Field\n\t\t\t\t\t\t\t\ttype='text'\n\t\t\t\t\t\t\t\ticon={PenNib}\n\t\t\t\t\t\t\t\tcontrol={control}\n\t\t\t\t\t\t\t\tname='author'\n\t\t\t\t\t\t\t\tplaceholder='Author'\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className='md:w-1/4'>\n\t\t\t\t\t\t\t<h1 className='my-2'>Rating</h1>\n\t\t\t\t\t\t\t<Field\n\t\t\t\t\t\t\t\ticon={Star}\n\t\t\t\t\t\t\t\ttype='number'\n\t\t\t\t\t\t\t\tcontrol={control}\n\t\t\t\t\t\t\t\tname='rating'\n\t\t\t\t\t\t\t\tplaceholder='Rating'\n\t\t\t\t\t\t\t\tmin={1}\n\t\t\t\t\t\t\t\tmax={5}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<h1 className='mb-2 mt-4'>Description</h1>\n\t\t\t\t\t<FormTextArea\n\t\t\t\t\t\tcontrol={control}\n\t\t\t\t\t\tname='description'\n\t\t\t\t\t\tplaceholder='Enter description'\n\t\t\t\t\t\tclassName='h-[250px]'\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<EbookEditor control={control} name='ebook' />\n\t\t\t<Button\n\t\t\t\tsize='md'\n\t\t\t\tisLoading={form.createLoading}\n\t\t\t\tclassName='mt-4'\n\t\t\t\tvariant={Object.keys(form.errors).length > 0 ? 'danger' : 'foreground'}\n\t\t\t\tonClick={form.handleCreate}>\n\t\t\t\tCreate\n\t\t\t</Button>\n\t\t</div>\n\t)\n}\n\nexport default Page\n","export const secureRoutes = {\n\tbookCatalogRoute: '/admin/book' + '/catalog',\n\tbookCreateRoute: '/admin/book' + '/create',\n\tbookCreateWithTemplateRoute: (slug: string) =>\n\t\t'/admin/book' + '/create?template=' + slug,\n\tbookUpdateRoute: (slug: string) => '/admin/book/' + slug + '/update',\n\tbookOverviewRoute: (slug: string) => '/admin/book/' + slug,\n\tparserCatalogRoute: '/admin/parser' + '/catalog',\n\tuserCatalogRoute: '/admin/user' + '/catalog',\n\tdashboard: '/admin/dashboard'\n}\n\nexport const publicRoutes = {\n\tlogin: '/login'\n}\n"],"names":["Promise","resolve","then","__webpack_require__","bind","useTemplate","templateSlug","reset","param","data","template","useQuery","queryKey","queryFn","api","parser","bySlug","enabled","Boolean","select","mutateAsync","deleteTemplate","useMutation","mutationKey","mutationFn","remove","onError","errorToast","useLayoutEffect","title","description","author","rating","genres","shortGenreSchema","z","object","slug","string","name","icon","CreateBookSchema","max","min","ebook","array","EBookPayloadSchema","number","positive","picture","useCreateForm","parameters","useSearchParams","validateStringParameter","get","router","useRouter","control","watch","handleSubmit","setValue","getValues","formState","errors","useForm","resolver","zodResolver","mode","create","isLoading","createLoading","book","payload","onSuccess","console","log","successToast","push","secureRoutes","bookCatalogRoute","handleCreate","page","form","jsx_runtime","jsxs","div","jsx","h1","className","SelectPicture","SelectGenres","Field","type","placeholder","PenNib","Star","FormTextArea","EbookEditor","Button","size","variant","Object","keys","length","onClick","bookCreateRoute","bookCreateWithTemplateRoute","bookUpdateRoute","bookOverviewRoute","parserCatalogRoute","userCatalogRoute","dashboard","publicRoutes","login"],"sourceRoot":""}